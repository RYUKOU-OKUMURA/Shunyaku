# ローカルホバー翻訳アプリ 実装プラン（Codex MCPレビュー版）

最終更新: 2025-09-23
レビュー者: Codex MCP + Claude Code
ベース: 要件定義書（tauri_react・非エンジニア向け）

---

## エグゼクティブサマリ

**目的**: macOS上で「スクショ→OCR→翻訳→即表示→保存」を5秒以内で実現するローカルアプリの開発
**技術スタック**: Tauri + React/TypeScript + TailwindCSS + Tesseract.js + DeepL API
**開発期間**: 22週間（6フェーズ）
**成功指標**: 翻訳5秒以内、失敗率<5%、設定復元100%、保存成功率100%

---

## プロジェクト構成

```
/Shunyaku
  /docs                 # 実装プラン・仕様書・手順書
  /src                  # React/TypeScript フロントエンド
    /components         # UIコンポーネント
    /store             # 状態管理・設定（Zustand）
    /workers           # Tesseract.js ワーカー
    /lib               # API・ユーティリティ
    /types             # 共有型定義
  /src-tauri           # Rust バックエンド（最小限）
    /src               # Tauriコマンド
  /tests               # E2Eテスト（Playwright）
  /.storybook          # UIコンポーネントドキュメント
```

---

## 改良された6フェーズ計画

###  Phase 1(Week 1-3): 基盤構築 + 早期検証
**目標**: 開発環境確立と技術リスク早期検証

1. **プロジェクトセットアップ**
   - [x] Tauriプロジェクト初期化（`create-tauri-app`）
   - [x] React + TypeScript + TailwindCSS 環境構築
   - [x] ESLint/Prettier/Vitest 導入

2. **技術PoC（新規追加）**
   - [ ] Tesseract.js冷起動時間・メモリ使用量計測
   - [ ] DeepL API レスポンス時間・レート制限確認
   - [ ] Tauriマルチウィンドウ（フローティングパネル）動作検証

3. **基盤実装**
   - [ ] 共有型定義作成（`tauri-specta`検討）
   - [ ] モックサービス（OCR/翻訳）
   - [ ] Storybook導入（非エンジニア向けUI確認）

4. **配布要件調査（前倒し）**
   - [ ] Apple Developer ID取得手順確認
   - [ ] コードサイニング・公証プロセス調査

**Exit条件**: OCR/翻訳のパフォーマンスベースライン確立、配布手順明確化

### Phase 2 (Week 4-7): 画像入力・OCR最適化
**目標**: OCR処理の実装と性能目標達成

1. **画像入力実装**
   - [ ] ドラッグ&ドロップゾーン（PNG/JPG/PDF対応）
   - [ ] クリップボード監視（`tauri-plugin-clipboard`）

2. **OCR実装・最適化**
   - [ ] Tesseract.js Web Worker統合
   - [ ] ワーカーウォームアップ機能
   - [ ] 言語データ（eng/jpn）キャッシュ戦略
   - [ ] 画像前処理パイプライン（リサイズ/二値化）

3. **性能検証（重要）**
   - [ ] 2000×1200px画像での処理時間計測
   - [ ] 各段階（画像読み込み→OCR→テキスト出力）の詳細プロファイリング
   - [ ] メモリ使用量監視

**Exit条件**: 標準画像で3秒以内OCR完了、メモリ制約内動作確認

### Phase 3 (Week 8-11): 翻訳統合・パイプライン構築
**目標**: OCR→翻訳の完全パイプライン実現

1. **翻訳API統合**
   - [ ] DeepL API抽象化レイヤー実装
   - [ ] APIキー安全保存（`tauri-plugin-store` + 暗号化）
   - [ ] レート制限・エラーハンドリング

2. **パイプライン最適化**
   - [ ] OCR結果の正規化・ノイズ除去
   - [ ] 翻訳キューイング・バッチ処理
   - [ ] 再試行戦略実装

3. **性能目標達成**
   - [ ] エンドツーエンド5秒以内達成
   - [ ] 失敗ケース定義と計測開始

**Exit条件**: 5秒以内翻訳達成、基本的な失敗率<5%

### Phase 4 (Week 12-15): UX向上・永続化・自動テスト
**目標**: 実用的なUIと信頼性の確保

1. **UI/UX実装**
   - [ ] フローティング結果パネル（ドラッグ移動・リサイズ）
   - [ ] 設定画面（言語・クリップボード監視・保存先）
   - [ ] ショートカット（⌘⌥T）
   - [ ] プログレス表示・エラートースト

2. **データ永続化**
   - [ ] 履歴機能（直近10件、IndexedDB）
   - [ ] 設定の復元機能
   - [ ] ウィンドウ位置記憶

3. **自動テスト導入**
   - [ ] Playwright E2Eテスト構築
   - [ ] 翻訳フロー全体の回帰テスト
   - [ ] パフォーマンステスト自動化

**Exit条件**: 非エンジニアが操作可能なUI完成、自動テスト網構築

### Phase 5 (Week 16-19): 高度機能・外部連携
**目標**: 付加価値機能と実用性向上

1. **高度OCR機能**
   - [ ] 画像前処理オプション（コントラスト・ノイズ除去）
   - [ ] 複数言語対応検討

2. **翻訳機能強化**
   - [ ] 簡易用語集・辞書機能
   - [ ] 翻訳履歴検索

3. **外部連携**
   - [ ] URLスキーム保存（Obsidian等）
   - [ ] Downloadsフォールバック
   - [ ] 保存失敗0%の実現

4. **ネイティブOCR準備**
   - [ ] Rust側OCRライブラリ調査
   - [ ] FFI境界設計検討

**Exit条件**: 外部連携100%成功、ネイティブOCR移行準備完了

### Phase 6 (Week 20-22): 配布準備・ドキュメント・品質保証
**目標**: リリース可能な品質とサポート体制構築

1. **セキュリティ・プライバシー**
   - [ ] セキュリティレビュー実施
   - [ ] プライバシーポリシー策定
   - [ ] ライセンス管理（OSS依存関係）

2. **配布準備**
   - [ ] Apple Developer ID署名
   - [ ] アプリ公証（notarization）
   - [ ] インストーラー（.dmg）作成

3. **サポート体制**
   - [ ] ユーザーマニュアル・FAQ作成
   - [ ] クラッシュレポート収集仕組み
   - [ ] ログ収集・匿名化ポリシー

4. **品質保証**
   - [ ] 最終統合テスト
   - [ ] 非エンジニアによるベータテスト
   - [ ] 成功指標達成確認

**Exit条件**: リリース候補版完成、配布・サポート体制確立

---

## 技術決定事項（レビュー反映）

### 修正・追加事項
1. **性能検証の前倒し**: Phase 2でOCR性能、Phase 3で翻訳性能を必達
2. **配布準備の前倒し**: Phase 1で調査、Phase 6で実装（リスク軽減）
3. **自動テストの早期導入**: Phase 4でPlaywright導入（品質保証）
4. **ドキュメント化強化**: Storybook等で非エンジニア向け可視化

### 技術スタック詳細
- **状態管理**: Zustand（軽量・TypeScript親和性）
- **翻訳API**: DeepL（高品質・日本語対応、Glossary対応）
- **OCR**: Tesseract.js → 将来的にRustネイティブOCR移行
- **設定保存**: tauri-plugin-store + 暗号化
- **テスト**: Vitest（ユニット） + Playwright（E2E）
- **UI文書**: Storybook（非エンジニア向け）

---

## 成功指標詳細定義

### 性能指標
- **翻訳5秒以内**: 画像取得開始→翻訳結果表示完了まで
  - 計測地点: ドロップ開始→パネル表示
  - 対象: 2000×1200px英語UI画像
  - 環境: M1/M2 Mac, 安定ネット環境

### 品質指標
- **失敗率<5%**: 10回連続操作での成功率
  - OCR失敗: テキスト抽出0文字
  - 翻訳失敗: API呼び出し失敗・タイムアウト
  - UI失敗: アプリクラッシュ・応答なし

### 機能指標
- **設定復元100%**: アプリ再起動後の設定値維持
- **保存成功100%**: URLスキーム→フォールバック含む

### 自動計測方法
- Playwright E2Eテストで全指標を継続計測
- CI/CDパイプラインでの回帰検知
- 本番リリース前の最終検証

---

## リスク管理・対策

### 技術リスク
1. **OCR性能・精度不足**
   - 対策: Phase 2で早期検証、前処理オプション、ネイティブ移行準備

2. **Tauriプラグイン不安定**
   - 対策: Phase 1でマルチウィンドウPoC、代替手段調査

3. **翻訳API依存**
   - 対策: 抽象化レイヤー、複数プロバイダー対応設計

### プロジェクトリスク
1. **非エンジニア開発の限界**
   - 対策: 小タスク分割、Storybook活用、AI協働最適化

2. **配布・署名の複雑性**
   - 対策: Phase 1で調査、詳細手順書作成

---

## 次のアクション

1. **Phase 1 開始準備**
   - [ ] 開発環境セットアップ
   - [ ] 技術PoC計画詳細化
   - [ ] Codex MCP協働体制確立

2. **継続的改善**
   - [ ] 週次レビューでフェーズ調整
   - [ ] 成功指標の継続計測
   - [ ] ドキュメント更新

---

## 付録: Codex MCP主要指摘事項

### 重要な改善点
- OCR/翻訳の性能検証前倒し
- 配布準備の早期着手
- 成功指標の明確化・計測方法確立
- 非エンジニア向けドキュメント強化
- セキュリティ・プライバシー考慮の体系化

### 技術的考慮事項
- Tesseract.js Cold start対策
- Tauriマルチウィンドウ実装課題
- DeepL API制限・コスト最適化
- ネイティブOCR移行設計

この改良版プランは、元の要件を満たしつつ、実装上の重要なリスクと対策を体系化したものです。
